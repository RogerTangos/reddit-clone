// Generated by CoffeeScript 1.6.3
var bindArrows, bindTabs, displayPosts, fetchPosts, fetchTest, foo, vote;

foo = null;

fetchTest = function(query) {
  console.log(query["subreddit"]);
  console.log(query["sort"]);
  return $.ajax({
    type: "POST",
    url: 'php/test.php',
    data: {
      "subreddit": query["subreddit"],
      "sort": query["sort"]
    },
    success: function(data) {
      return console.log(data);
    }
  });
};

fetchPosts = function(query) {
  console.log("fetchPosts called");
  return $.ajax({
    type: "POST",
    url: 'php/retrievePosts.php',
    data: {
      "subreddit": query["subreddit"],
      "sort": query["sort"]
    },
    success: function(data) {
      displayPosts(data);
      return bindArrows();
    },
    dataType: 'json'
  });
};

displayPosts = function(data) {
  var downvote, id, post, row, subreddit, title, type, upvote, url, username, _i, _len, _results;
  console.log("displayAll called");
  _results = [];
  for (_i = 0, _len = data.length; _i < _len; _i++) {
    post = data[_i];
    id = post['id'];
    title = post['title'];
    url = post['url'];
    subreddit = post['subreddit'];
    upvote = post['upvote'];
    downvote = post['downvote'];
    type = post['type'];
    username = post['username'];
    row = null;
    if (type === "1") {
      row = "<div class='row postrow'>		            <div class='col-md-10 col-lg-10 col-xs-10 reddit-link'>		            	<div class='post-image-container'>							<img class='post-image' src='" + url + "' alt='post image'>		                </div>		                <div class='post-text-container'>		                	<a href='" + url + "'>" + title + "</a>								                	<div></div>			                <div class='details submission'>submitted by <a href='reddit.com/u/user'>" + username + "</a> to <a href='reddit.com/r/subreddit'>" + subreddit + "</a>			                </div>			                <div class='details comments'>" + Math.floor(Math.random() * 100000) + "			                comments -></div>		            	</div>		            </div>		            <div class='col-md-2 col-lg-2 col-xs-2 '>		                <div class='vote'>		                    <span class='glyphicon glyphicon-arrow-up arrow' id='uparrow-" + id + "'></span>		                    <span class='count'>" + (upvote - downvote) + " </span>		                    <span class='glyphicon glyphicon-arrow-down arrow' id='downarrow-" + id + "'></span>		                </div>		            </div>		        </div>";
    } else if (type === '2') {
      row = "<div class='row postrow'>		            <div class='col-md-10 col-lg-10 col-xs-10 reddit-link'>" + title + "<div></div>		                <div class='details submission'>submitted by <a href='reddit.com/u/user'>" + username + "</a> to <a href='reddit.com/r/subreddit'>" + subreddit + "</a>		                </div>		                <div class='details comments'> " + Math.floor(Math.random() * 100000) + "		                 comments -></div>		            </div>		            <div class='col-md-2 col-lg-2 col-xs-2 '>		                <div class='vote'>		                    <span class='glyphicon glyphicon-arrow-up arrow' id='uparrow-" + id + "'></span>		                    <span class='count'>" + (upvote - downvote) + " </span>		                    <span class='glyphicon glyphicon-arrow-down arrow' id='downarrow-" + id + "'></span>		                </div>		            </div>		        </div>";
    }
    _results.push($('#todo-row').after(row));
  }
  return _results;
};

vote = function(type, id) {
  return $.ajax({
    type: "POST",
    url: 'php/vote.php',
    data: {
      "id": id,
      "type": type
    },
    success: function(data) {
      console.log("vote success");
      return console.log(data);
    }
  });
};

bindTabs = function() {
  console.log('bindTabs called');
  $('#hot').click(function() {
    $(".postrow").remove();
    return fetchPosts({
      "sort": "top",
      "subreddit": "all"
    });
  });
  $('#new').click(function() {
    $(".postrow").remove();
    return fetchPosts({
      "sort": "new",
      "subreddit": "all"
    });
  });
  $('#controversial').click(function() {
    $(".postrow").remove();
    return fetchPosts({
      "sort": "controversial",
      "subreddit": "all"
    });
  });
  return $('#top').click(function() {
    $(".postrow").remove();
    return fetchPosts({
      "sort": "top",
      "subreddit": "all"
    });
  });
};

bindArrows = function() {
  console.log("bindArrows called");
  $(".glyphicon-arrow-down").click(function() {
    var id;
    $(this).toggleClass("glyphicon-arrow-down-clicked");
    id = $(this).attr('id').match('[0-9]+')[0];
    return vote("downvote", id);
  });
  $(".glyphicon-arrow-up").click(function() {
    var id;
    $(this).toggleClass("glyphicon-arrow-up-clicked");
    id = $(this).attr('id').match('[0-9]+')[0];
    return vote("upvote", id);
  });
};

$(document).ready(function() {
  console.log("document ready");
  $(".postrow").remove();
  fetchPosts({
    "sort": "top",
    "subreddit": "all"
  });
  return bindTabs();
});
